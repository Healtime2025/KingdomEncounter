<!DOCTYPE html>


// Share buttons
const inviteLink = location.href.split('#')[0];
document.getElementById('wa').href = 'https://wa.me/?text=' + encodeURIComponent(`You are invited: ${eventName}\n${dateStr} · ${venueStr}\nConfirm here: ${inviteLink}`);
document.getElementById('sms').href = 'sms:?&body=' + encodeURIComponent(`${eventName} — ${dateStr} · ${venueStr}\nConfirm: ${inviteLink}`);
document.getElementById('mail').href = 'mailto:?subject=' + encodeURIComponent(`Invitation: ${eventName}`) + '&body=' + encodeURIComponent(`${dateStr} · ${venueStr}\nConfirm here: ${inviteLink}`);


// Show live counts
fetch(SCRIPT_URL + '?action=stats').then(r=>r.json()).then(({counts})=>{
if (!counts) return;
const el = document.getElementById('counts');
el.style.display='flex';
el.innerHTML = `<span>✅ Yes: ${counts.yes}</span><span>🤔 Maybe: ${counts.maybe}</span><span>❌ No: ${counts.no}</span><span>Total: ${counts.total}</span>`;
}).catch(()=>{});


// Duplicate guard by localStorage (per event)
const keyBase = 'flowrsvp:' + eventName;


function respond(choice){
const already = localStorage.getItem(keyBase);
if (already){
showModal('You’re all set ✅', 'Your previous response is already recorded.');
return;
}


const payload = new URLSearchParams();
payload.set('name', document.getElementById('name').value.trim());
payload.set('phone', document.getElementById('phone').value.trim());
payload.set('choice', choice);
payload.set('event', eventName);
payload.set('date', dateStr);
payload.set('venue', venueStr);
payload.set('ref', ref);
payload.set('userAgent', navigator.userAgent);


fetch(SCRIPT_URL, { method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded'}, body:payload })
.then(r=>r.json())
.then(res=>{
if (res.ok){
localStorage.setItem(keyBase, choice);
showModal('Thank you! 🎉', `We’ve recorded your response: ${choice.toUpperCase()}. See you soon.`);
// Update counts if present
if (res.counts){
const c = res.counts;
document.getElementById('counts').innerHTML = `<span>✅ Yes: ${c.yes}</span><span>🤔 Maybe: ${c.maybe}</span><span>❌ No: ${c.no}</span><span>Total: ${c.total}</span>`;
}
} else {
showModal('Oops', res.error || 'Could not save your response.');
}
})
.catch(()=> showModal('Oops', 'Network error. Please try again.'));
}


function showModal(title,msg){
document.getElementById('thanksTitle').textContent = title;
document.getElementById('thanksMsg').textContent = msg;
document.getElementById('modal').classList.add('active');
}
function closeModal(){ document.getElementById('modal').classList.remove('active'); }
</script>
</body>
</html>
